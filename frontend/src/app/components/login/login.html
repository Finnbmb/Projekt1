<div class="login-container">
  <!-- LOGIN FORM -->
  @if (!showRegister() && !showForgotPassword()) {
    <div class="login-wrapper">
      <!-- Hero Section -->
      <div class="login-hero">
        <div class="brand-section">
          <div class="brand-icon-wrapper">
            <mat-icon class="brand-icon">event_note</mat-icon>
          </div>
          <h1 class="brand-title">Terminkalender</h1>
          <p class="brand-subtitle">Ihre persönliche Terminverwaltung</p>
        </div>
      </div>
      
      <!-- Login Card -->
      <mat-card class="login-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon class="login-icon">login</mat-icon>
            Anmelden
          </mat-card-title>
          <mat-card-subtitle>Willkommen zurück! Melden Sie sich an, um fortzufahren.</mat-card-subtitle>
        </mat-card-header>
    
    <mat-card-content>
      <form [formGroup]="loginForm" (ngSubmit)="onSubmit()" class="login-form">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Benutzername</mat-label>
          <input matInput 
                 formControlName="email" 
                 placeholder="Geben Sie Ihren Benutzernamen ein"
                 autocomplete="username">
          @if (loginForm.get('email')?.touched && loginForm.get('email')?.invalid) {
            <mat-error>{{ getFieldError('email') }}</mat-error>
          }
        </mat-form-field>
        
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Passwort</mat-label>
          <input matInput 
                 type="password" 
                 formControlName="password" 
                 placeholder="Geben Sie Ihr Passwort ein"
                 autocomplete="current-password">
          @if (loginForm.get('password')?.touched && loginForm.get('password')?.invalid) {
            <mat-error>{{ getFieldError('password') }}</mat-error>
          }
        </mat-form-field>
        
        @if (loginError()) {
          <div class="error-message">
            {{ loginError() }}
          </div>
        }
      </form>
    </mat-card-content>
    
        <mat-card-actions class="login-actions">
          <button mat-raised-button 
                  type="submit" 
                  [disabled]="isLoading()"
                  (click)="onSubmit()"
                  class="login-button primary-btn">
            @if (isLoading()) {
              <mat-spinner diameter="20" class="spinner-inline"></mat-spinner>
              Anmeldung läuft...
            } @else {
              <mat-icon>login</mat-icon>
              Anmelden
            }
          </button>
        </mat-card-actions>
        
        <!-- Additional Actions -->
        <mat-card-content class="additional-actions">
          <div class="action-links">
            <button type="button" class="link-button register-btn" (click)="showRegisterForm()">
              <mat-icon>person_add</mat-icon>
              Noch kein Konto? Jetzt registrieren
            </button>
            <button type="button" class="link-button forgot-btn" (click)="showForgotPasswordForm()">
              <mat-icon>lock_reset</mat-icon>
              Passwort vergessen?
            </button>
          </div>
        </mat-card-content>
      </mat-card>
    </div>
  }

  <!-- Register Form -->
  @if (showRegister()) {
    <div class="login-wrapper">
      <!-- Hero Section -->
      <div class="login-hero register-hero">
        <div class="brand-section">
          <div class="brand-icon-wrapper">
            <mat-icon class="brand-icon">person_add</mat-icon>
          </div>
          <h1 class="brand-title">Konto erstellen</h1>
          <p class="brand-subtitle">Werden Sie Teil unserer Terminkalender-Community</p>
        </div>
      </div>
      
      <!-- Register Card -->
      <mat-card class="login-card register-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon class="login-icon">how_to_reg</mat-icon>
            Registrierung
          </mat-card-title>
          <mat-card-subtitle>Füllen Sie die Informationen aus, um Ihr Konto zu erstellen</mat-card-subtitle>
        </mat-card-header>
      
      <mat-card-content>
        <form [formGroup]="registerForm" (ngSubmit)="onRegister()" class="login-form">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Benutzername</mat-label>
            <input matInput formControlName="username" placeholder="Gewünschter Benutzername">
            <mat-error *ngIf="registerForm.get('username')?.hasError('required')">
              Benutzername ist erforderlich
            </mat-error>
          </mat-form-field>
          
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>E-Mail</mat-label>
            <input matInput type="email" formControlName="email" placeholder="ihre@email.de">
            <mat-error *ngIf="registerForm.get('email')?.hasError('required')">
              E-Mail ist erforderlich
            </mat-error>
            <mat-error *ngIf="registerForm.get('email')?.hasError('email')">
              Ungültige E-Mail-Adresse
            </mat-error>
          </mat-form-field>
          
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Vollständiger Name</mat-label>
            <input matInput formControlName="name" placeholder="Ihr vollständiger Name">
            <mat-error *ngIf="registerForm.get('name')?.hasError('required')">
              Name ist erforderlich
            </mat-error>
          </mat-form-field>
          
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Passwort</mat-label>
            <input matInput type="password" formControlName="password" placeholder="Sicheres Passwort">
            <mat-error *ngIf="registerForm.get('password')?.hasError('required')">
              Passwort ist erforderlich
            </mat-error>
            <mat-error *ngIf="registerForm.get('password')?.hasError('minlength')">
              Passwort muss mindestens 6 Zeichen haben
            </mat-error>
          </mat-form-field>
          
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Passwort bestätigen</mat-label>
            <input matInput type="password" formControlName="confirmPassword" placeholder="Passwort wiederholen">
            <mat-error *ngIf="registerForm.get('confirmPassword')?.hasError('required')">
              Passwort-Bestätigung ist erforderlich
            </mat-error>
          </mat-form-field>
          
          @if (registerError()) {
            <div class="error-message">
              {{ registerError() }}
            </div>
          }
        </form>
      </mat-card-content>
      
        <mat-card-actions class="register-actions">
          <button mat-stroked-button (click)="hideRegisterForm()" class="cancel-btn">
            <mat-icon>arrow_back</mat-icon>
            Zurück
          </button>
          <button mat-raised-button 
                  [disabled]="isLoading()"
                  (click)="onRegister()"
                  class="register-button primary-btn">
            @if (isLoading()) {
              <mat-spinner diameter="20" class="spinner-inline"></mat-spinner>
              Registrierung läuft...
            } @else {
              <mat-icon>how_to_reg</mat-icon>
              Registrieren
            }
          </button>
        </mat-card-actions>
      </mat-card>
    </div>
  }

  <!-- Forgot Password Form -->
  @if (showForgotPassword()) {
    <div class="login-wrapper">
      <!-- Hero Section -->
      <div class="login-hero forgot-hero">
        <div class="brand-section">
          <div class="brand-icon-wrapper">
            <mat-icon class="brand-icon">lock_reset</mat-icon>
          </div>
          <h1 class="brand-title">Passwort vergessen?</h1>
          <p class="brand-subtitle">Kein Problem! Wir helfen Ihnen dabei, wieder Zugang zu erhalten</p>
        </div>
      </div>
      
      <!-- Forgot Password Card -->
      <mat-card class="login-card forgot-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon class="login-icon">email</mat-icon>
            Passwort zurücksetzen
          </mat-card-title>
          <mat-card-subtitle>Geben Sie Ihre E-Mail-Adresse ein, um einen Reset-Link zu erhalten</mat-card-subtitle>
        </mat-card-header>
      
      <mat-card-content>
        <form [formGroup]="forgotPasswordForm" (ngSubmit)="onForgotPassword()" class="login-form">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>E-Mail</mat-label>
            <input matInput type="email" formControlName="email" placeholder="ihre@email.de">
            <mat-error *ngIf="forgotPasswordForm.get('email')?.hasError('required')">
              E-Mail ist erforderlich
            </mat-error>
            <mat-error *ngIf="forgotPasswordForm.get('email')?.hasError('email')">
              Ungültige E-Mail-Adresse
            </mat-error>
          </mat-form-field>
          
          @if (forgotPasswordError()) {
            <div class="error-message">
              {{ forgotPasswordError() }}
            </div>
          }
          
          @if (forgotPasswordSuccess()) {
            <div class="success-message">
              {{ forgotPasswordSuccess() }}
            </div>
          }
        </form>
      </mat-card-content>
      
        <mat-card-actions class="forgot-actions">
          <button mat-stroked-button (click)="hideForgotPasswordForm()" class="cancel-btn">
            <mat-icon>arrow_back</mat-icon>
            Zurück
          </button>
          <button mat-raised-button 
                  [disabled]="isLoading()"
                  (click)="onForgotPassword()"
                  class="reset-button primary-btn">
            @if (isLoading()) {
              <mat-spinner diameter="20" class="spinner-inline"></mat-spinner>
              Wird gesendet...
            } @else {
              <mat-icon>send</mat-icon>
              Reset-Link senden
            }
          </button>
        </mat-card-actions>
      </mat-card>
    </div>
  }
</div>
